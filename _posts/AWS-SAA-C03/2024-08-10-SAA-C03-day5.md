---
title: "SAA-C03 Day 5 | ELB(High Availability) & ASG (Scalability)"
date: 2024-08-10 00:00:00
categories: [AWS, SAA-C03]
tags: [ELB, ASG]
---


## Load Balancer
- they are servers that forward traffic to multiple servers (e.g EC2)
- expose **a single point of access** (DNS) to application
- health check
- TLS/SSL
- stickiness with cookies
- separate public traffic from private traffic
- security group for load balancer

### target group
**Definition:** is a logical grouping of backend resources that an (ALB) or (NLB) can route traffic to

- **what is in group:**  The resources that can receive traffic, which depends on type of load balancer
- **Health Checks:** You can configure health checks for the target group, which periodically checks the health of the targets. The load balancer will route traffic only to healthy targets (TCP, HTTP/s)

### Application Load Balancer (Http/Https)
- Target Group: EC2 instances, Private IP addresses, or AWS Lambda functions.
- can redirect
- fit for microservices & docker ecs
- the application can get client IP , port, proto from header (X-Forwarded-For, X-Forwarded-Port, X-Forwarded-Proto)

#### Routing tables to different target groups (Listener rules)
You can define return response or forward to specific target group
- Routing based on path in URL (path)
- Routing based on hostname in URL
- Routing based in Query String Header (path variable)

#### In Practice
- Load Balancer accept the external traffic where our application should only receive traffic from load balancer (security group should set to LB's security group)

### Network Load Balancer (TCP/UDP)
- Target Group: EC2 instances, Private IP address, Application Load Balancer
- high performance
- one static IP per AZ, and supports assigning Elastic IP

### Gateway Load Balancer
- Target Group: EC2 instances, Private IP address
- used to check all incoming request by firewall before reach to application

#### In Practice
User send request to Gateway Load Balancer, it will forward to the target group of firewall check, then firewall service can either drop the traffic , 
or returning back the traffic to load balancer then to application


## Load Balancer : Sticky Sessions
- same client is always redirected to the same instance behind a load balancer
- `cookie" is used for stickiness has an expiration date you control
- works for ALB, NLB
- **Load Balancer-Generated Cookies:** default cookie name are `AWSALB`, `AWSELB`, `AWSNLB`
- **Application-Based Cookies:**


## Load Balancer: Cross-Zone Load Balancing
<img width="1115" alt="Screenshot 2024-08-10 at 18 58 29" src="https://github.com/user-attachments/assets/7f17ff5d-3ed8-4b3c-b9ef-cf9d03dfecf4">


- ALB is enabled by default (can be disabled at the Target Group Level)
- NLB & GLB (disabled by default, extrac cost)


## Load Balancer: SSL Certificates
Use case: Users send and receive request to load balancer using https, and forward to instance in private VPC
- the load balancer uses an X.509 certificate (SSL.TLS server certificate)
- can manage certificate using ACM

### SNI server Name Indication
- Without SNI, when a client attempts to establish a TLS connection, the server doesn't know which certificate to present until after the encrypted connection is established. This poses a problem for servers hosting multiple websites (or virtual hosts) on the same IP address because they might not know which SSL/TLS certificate to use.
1. When a client (like a web browser) initiates a TLS handshake with a server, it sends a "Client Hello" message.
   With SNI, this "Client Hello" message includes the hostname (domain name) that the client is trying to connect to.
2. he server receives the "Client Hello" message and checks the hostname provided in the SNI extension.
   Based on the hostname, the server selects the appropriate SSL/TLS certificate for that domain and sends it back to the client in the "Server Hello" message.


### Connection Draining

<img width="499" alt="Screenshot 2024-08-10 at 18 57 34" src="https://github.com/user-attachments/assets/7fc3f530-b780-47de-bd82-819dff8df609">
- Time to complete “in-flight requests” while the instance is de-registering or unhealthy
- Stops sending new requests to the EC2 instance which is de-registering
- Between 1 to 3600 seconds (default: 300 seconds)
- Can be disabled (set value to 0)
- Set to a low value if your requests are short


### Auto Scaling Group
-  health check on asg level
- A launch Template (AMI, instance type, User Data, Network, Role, Load Balancer info .etc)
- MinSize/ MaxSize/ Initial Capacity
- Scaling Policy

#### Scaling Policy
scale an ASG based on metric, alarms to scale in & scale out.
- Dynamic Scaling
  - Target Tracking: want CPU around 40
  - Step Scaling: example(CPU > 70) then add
- Schedule Scaling
  - add to 10 when  7am
- Predictive scaling: continuously forecast and schedule scaling ahead
- scaling cooldown period (default 300): during cooldown, ASG will not launch or terminate
